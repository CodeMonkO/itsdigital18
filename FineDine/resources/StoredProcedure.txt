DELIMITER $$
DROP PROCEDURE IF EXISTS `finedinedb`.`restaurantProc` $$
CREATE PROCEDURE `finedinedb`.`restaurantProc`(IN uuidParam VARCHAR(21), IN requestedSeats INTEGER) 

    BEGIN
	DECLARE BookedSeats, MaxSeats, UpdatedSeats INTEGER DEFAULT 0;
	SELECT CAST(bookedseat AS UNSIGNED),CAST(maxseat AS UNSIGNED) INTO BookedSeats, MaxSeats FROM restaurantlive WHERE UUID = uuidParam LOCK IN SHARE MODE;
	SET UpdatedSeats = BookedSeats + requestedSeats;
	IF requestedSeats <= (MaxSeats - BookedSeats) THEN
		START TRANSACTION;
		UPDATE restaurantlive SET bookedseat = UpdatedSeats, statusFlag = '1' WHERE UUID = uuidParam;
		COMMIT;
	END IF;
	IF MaxSeats = UpdatedSeats THEN
		START TRANSACTION;
		UPDATE restaurantlive SET statusFlag = '0' WHERE UUID = uuidParam;
		COMMIT;
	END IF;
    END$$

DELIMITER ;

